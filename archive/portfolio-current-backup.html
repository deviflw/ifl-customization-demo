<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>Portfolio - IFL Watches</title>
    
    <!-- Shared styles (DRY!) -->
    <link rel="stylesheet" href="shared/base.css">
    <link rel="stylesheet" href="shared/navigation.css">
    <link rel="stylesheet" href="shared/portfolio.css">
    <link rel="stylesheet" href="shared/portfolio-filters.css">
    <link rel="stylesheet" href="shared/modal.css">
    
    <!-- Navigation script -->
    <script src="shared/navigation.js"></script>
    
    <!-- Portfolio data -->
    <script src="shared/portfolio-data.js"></script>
</head>
<body>
    <!-- Navigation –±—É–¥–µ—Ç –≤—Å—Ç–∞–≤–ª–µ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ navigation.js -->

    <!-- Portfolio Content -->
    <main class="portfolio-container">
        <!-- Header -->
        <div class="portfolio-header">
            <h1>PORTFOLIO</h1>
            <p>Explore our collection of hand-painted masterpieces, each telling a unique story</p>
        </div>
        
        <!-- Filters -->
        <div class="portfolio-filters">
            <div class="filter-group">
                <label for="styleFilter">Style:</label>
                <select id="styleFilter">
                    <option value="">All Styles</option>
                </select>
            </div>
            
            <div class="filter-group">
                <label for="themeFilter">Theme:</label>
                <select id="themeFilter">
                    <option value="">All Themes</option>
                </select>
            </div>
            
            <div class="filter-group">
                <label for="typeFilter">Type:</label>
                <select id="typeFilter">
                    <option value="">All Types</option>
                    <option value="bespoke_concept">Bespoke Designs</option>
                    <option value="custom_order">Client Commissions</option>
                </select>
            </div>
        </div>
        
        <!-- Portfolio Grid -->
        <div class="portfolio-grid" id="portfolioGrid">
            <div class="portfolio-loading">Loading portfolio...</div>
        </div>
    </main>

    <script>
        // Portfolio renderer
        class PortfolioGrid {
            constructor() {
                this.grid = document.getElementById('portfolioGrid');
                this.filters = {
                    style: '',
                    theme: '',
                    type: ''
                };
                this.typeLabels = {
                    'bespoke_concept': 'Bespoke',
                    'custom_order': 'Commission'
                };
                this.init();
            }
            
            init() {
                this.populateFilters();
                this.attachEventListeners();
                this.render();
            }
            
            populateFilters() {
                // Populate style filter
                const styleSelect = document.getElementById('styleFilter');
                portfolioMetaobjects.styles.forEach(style => {
                    const option = document.createElement('option');
                    option.value = style.id;
                    option.textContent = style.name;
                    styleSelect.appendChild(option);
                });
                
                // Populate theme filter
                const themeSelect = document.getElementById('themeFilter');
                portfolioMetaobjects.themes.forEach(theme => {
                    const option = document.createElement('option');
                    option.value = theme.id;
                    option.textContent = theme.name;
                    themeSelect.appendChild(option);
                });
            }
            
            attachEventListeners() {
                document.getElementById('styleFilter').addEventListener('change', (e) => {
                    this.filters.style = e.target.value;
                    this.render();
                });
                
                document.getElementById('themeFilter').addEventListener('change', (e) => {
                    this.filters.theme = e.target.value;
                    this.render();
                });
                
                document.getElementById('typeFilter').addEventListener('change', (e) => {
                    this.filters.type = e.target.value;
                    this.render();
                });
            }
            
            render() {
                const items = portfolioHelpers.filterItems(this.filters);
                
                if (items.length === 0) {
                    this.grid.innerHTML = `
                        <div class="portfolio-empty">
                            <p>No items found matching your filters.</p>
                            <button class="btn-reset-filters" onclick="portfolioGrid.resetFilters()">
                                Reset Filters
                            </button>
                        </div>
                    `;
                    return;
                }
                
                this.grid.innerHTML = items.map(item => this.createCard(item)).join('');
                
                // Add click handlers for mobile
                this.addMobileHandlers();
            }
            
            createCard(item) {
                const badges = [];
                if (item.video_url) badges.push('<span class="badge badge-video">üé• Video</span>');
                if (item.instagram_url) badges.push('<span class="badge badge-instagram">üì∑ Instagram</span>');
                if (item.timelapse_url) badges.push('<span class="badge badge-timelapse">‚è± Timelapse</span>');
                
                // –ö—Ä–∞—Å–∏–≤—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è –¥–ª—è —Ç–∏–ø–æ–≤
                const typeLabels = {
                    'custom_order': 'Commission',
                    'bespoke_concept': 'Bespoke',
                    'product': 'Ready' // –æ—Å—Ç–∞–≤–∏–º –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
                };
                
                return `
                    <div class="portfolio-card" data-id="${item.id}">
                        <div class="portfolio-image-wrapper" onclick="window.location.href='/portfolio-single.html?id=${item.handle}'">
                            <img src="${item.main_image}" alt="${item.title}" loading="lazy">
                            
                            ${badges.length > 0 ? `
                                <div class="portfolio-badges">
                                    ${badges.join('')}
                                </div>
                            ` : ''}
                            
                            <div class="portfolio-overlay">
                                <button class="btn-quick-view" onclick="event.stopPropagation(); portfolioGrid.openQuickView('${item.id}')">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                                        <circle cx="12" cy="12" r="3"/>
                                    </svg>
                                    <span>Quick View</span>
                                </button>
                            </div>
                        </div>
                        
                        <div class="portfolio-info">
                            <h4>${item.title}</h4>
                            <div class="portfolio-meta">
                                <div class="portfolio-tags">
                                    <span class="tag tag-style">${item.style.name}</span>
                                    <span class="tag tag-theme">${item.theme.name}</span>
                                </div>
                                <span class="portfolio-type">${typeLabels[item.portfolio_type]}</span>
                            </div>
                            ${item.watch_product ? 
                                `<p class="portfolio-watch">${item.watch_product.title}</p>` 
                                : ''}
                        </div>
                    </div>
                `;
            }
            
            addMobileHandlers() {
                // –ù–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö –¥–µ–ª–∞–µ–º overlay –≤–∏–¥–∏–º—ã–º –ø–æ –∫–ª–∏–∫—É
                if (window.innerWidth <= 768) {
                    document.querySelectorAll('.portfolio-card').forEach(card => {
                        card.addEventListener('click', function(e) {
                            if (!e.target.closest('.btn-view-details')) {
                                // Toggle active class
                                document.querySelectorAll('.portfolio-card').forEach(c => {
                                    if (c !== this) c.classList.remove('active');
                                });
                                this.classList.toggle('active');
                            }
                        });
                    });
                }
            }
            
            viewDetails(itemId) {
                const item = portfolioHelpers.getActiveItems().find(p => p.id === itemId);
                if (item) {
                    // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ —ç—Ç–æ –±—ã –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–ª–æ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–µ—Ç–∞–ª–∏
                    console.log('View details for:', item);
                    alert(`Opening: ${item.title}\n\nThis would navigate to:\n/portfolio/${item.handle}`);
                }
            }
            
            openQuickView(itemId) {
                const item = portfolioHelpers.getActiveItems().find(p => p.id === itemId);
                if (!item) return;
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª
                const modal = document.getElementById('quickViewModal');
                const modalBody = modal.querySelector('.modal-body');
                
                // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç –¥–ª—è –º–æ–¥–∞–ª–∞
                modalBody.innerHTML = `
                    <div class="quick-view-container">
                        <div class="quick-view-gallery">
                            <div class="main-image">
                                <img src="${item.main_image}" alt="${item.title}">
                            </div>
                            ${item.images && item.images.length > 0 ? `
                                <div class="thumbnail-list">
                                    <div class="thumbnail active">
                                        <img src="${item.main_image}" alt="${item.title}">
                                    </div>
                                    ${item.images.map(img => `
                                        <div class="thumbnail">
                                            <img src="${img}" alt="${item.title}">
                                        </div>
                                    `).join('')}
                                </div>
                            ` : ''}
                        </div>
                        
                        <div class="quick-view-details">
                            <h2>${item.title}</h2>
                            
                            <div class="quick-view-tags">
                                <span class="tag tag-style">${item.style.name}</span>
                                <span class="tag tag-theme">${item.theme.name}</span>
                                <span class="portfolio-type">${this.typeLabels[item.portfolio_type]}</span>
                            </div>
                            
                            <p class="quick-view-description">${item.description || 'A unique custom timepiece design.'}</p>
                            
                            ${item.watch_product ? `
                                <div class="watch-details">
                                    <h3>Watch Details</h3>
                                    <p><strong>Model:</strong> ${item.watch_product.title}</p>
                                    <p><strong>Brand:</strong> ${item.watch_product.vendor}</p>
                                    <p><strong>Size:</strong> ${item.watch_product.size}</p>
                                    <p><strong>Price from:</strong> $${item.watch_product.price}</p>
                                </div>
                            ` : ''}
                            
                            <div class="quick-view-actions">
                                ${item.portfolio_type === 'bespoke_concept' ? 
                                    `<a href="${item.product_reference || '#'}" class="btn btn-primary">Order This Design</a>` :
                                    `<button class="btn btn-primary" onclick="window.location.href='/pages/bespoke'">Order Similar</button>`
                                }
                                <a href="/portfolio/${item.handle}" class="btn btn-secondary">View Full Details</a>
                            </div>
                        </div>
                    </div>
                `;
                
                // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –≥–∞–ª–µ—Ä–µ–∏
                const thumbnails = modalBody.querySelectorAll('.thumbnail');
                const mainImage = modalBody.querySelector('.main-image img');
                
                thumbnails.forEach(thumb => {
                    thumb.addEventListener('click', () => {
                        thumbnails.forEach(t => t.classList.remove('active'));
                        thumb.classList.add('active');
                        mainImage.src = thumb.querySelector('img').src;
                    });
                });
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª
                modal.classList.add('active');
                document.body.style.overflow = 'hidden';
            }
            
            closeQuickView() {
                const modal = document.getElementById('quickViewModal');
                modal.classList.remove('active');
                document.body.style.overflow = '';
            }
            
            resetFilters() {
                this.filters = { style: '', theme: '', type: '' };
                document.getElementById('styleFilter').value = '';
                document.getElementById('themeFilter').value = '';
                document.getElementById('typeFilter').value = '';
                this.render();
            }
        }
        
        // Initialize portfolio grid
        const portfolioGrid = new PortfolioGrid();
    </script>

    <!-- Quick View Modal -->
    <div id="quickViewModal" class="modal">
        <div class="modal-overlay" onclick="portfolioGrid.closeQuickView()"></div>
        <div class="modal-content">
            <button class="modal-close" onclick="portfolioGrid.closeQuickView()">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"/>
                    <line x1="6" y1="6" x2="18" y2="18"/>
                </svg>
            </button>
            <div class="modal-body">
                <!-- Content will be dynamically inserted here -->
            </div>
        </div>
    </div>

</body>
</html>