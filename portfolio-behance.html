<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>Portfolio - IFL Watches</title>
    
    <!-- Shared styles (DRY!) -->
    <link rel="stylesheet" href="shared/base.css">
    <link rel="stylesheet" href="shared/navigation.css">
    <link rel="stylesheet" href="shared/portfolio.css">
    <link rel="stylesheet" href="shared/behance-filters.css">  <!-- Sliding –ø–∞–Ω–µ–ª—å -->
    <link rel="stylesheet" href="shared/filters.css">  <!-- –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤ -->
    <link rel="stylesheet" href="shared/modal.css">
    
    <!-- Navigation script -->
    <script src="shared/navigation.js"></script>
    
    <!-- Portfolio data -->
    <script src="shared/portfolio-data.js"></script>
</head>
<body>
    <!-- Navigation –±—É–¥–µ—Ç –≤—Å—Ç–∞–≤–ª–µ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ navigation.js -->

    <!-- Portfolio Content -->
    <main class="portfolio-container">
        <!-- Header -->
        <div class="portfolio-header">
            <h1>PORTFOLIO</h1>
            <p>Explore our collection of hand-painted masterpieces, each telling a unique story</p>
        </div>
        
        <!-- Behance-style Filter Trigger -->
        <div class="portfolio-filter-trigger">
            <button class="filter-toggle-btn" onclick="toggleFilterPanel()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M10 18h4v-2h-4v2zM3 6v2h18V6H3zm3 7h12v-2H6v2z"/>
                </svg>
                <span>Filters</span>
                <span id="filterCount" style="display: none; margin-left: 5px; background: #333; color: white; padding: 2px 6px; border-radius: 10px; font-size: 11px;">0</span>
            </button>
        </div>

        <!-- Behance-style Layout -->
        <div class="portfolio-layout">
            <!-- Sliding Filter Sidebar -->
            <aside class="filter-sidebar" id="filterSidebar">
                <div class="filter-sections">
                    <!-- Active filters display INSIDE sidebar -->
                    <div class="active-filters active-filters-vertical" id="activeFilters" style="display: none;">
                        <span class="filters-label">Active filters:</span>
                        <div class="filter-tags" id="activeFilterTags"></div>
                        <button class="clear-all-btn" onclick="clearAllFilters()">Clear All</button>
                    </div>

                    <!-- Theme Filters -->
                    <div class="filter-group">
                        <label class="filter-label">Theme</label>
                        <div class="filter-buttons" id="themeFilters">
                            <!-- Will be populated by JS -->
                        </div>
                    </div>

                    <!-- Style Filters -->
                    <div class="filter-group">
                        <label class="filter-label">Style</label>
                        <div class="filter-buttons" id="styleFilters">
                            <!-- Will be populated by JS -->
                        </div>
                    </div>

                    <!-- Watch Model Filters -->
                    <div class="filter-group">
                        <label class="filter-label">Watch Model</label>
                        <div class="filter-buttons" id="watchFilters">
                            <!-- Will be populated by JS -->
                        </div>
                    </div>
                </div>
            </aside>

            <!-- Portfolio Grid Content -->
            <div class="portfolio-content">
                <div class="portfolio-grid" id="portfolioGrid">
                    <div class="portfolio-loading">Loading portfolio...</div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // Filter state management
        let filterPanelOpen = false;
        let activeFilters = {
            themes: [],
            styles: [],
            watchModels: []
        };

        // Toggle filter panel - with display none/block
        function toggleFilterPanel() {
            const sidebar = document.getElementById('filterSidebar');
            const button = document.querySelector('.filter-toggle-btn');
            const layout = document.querySelector('.portfolio-layout');
            const sections = sidebar.querySelector('.filter-sections');

            filterPanelOpen = !filterPanelOpen;

            if (filterPanelOpen) {
                // Opening: show content immediately, then animate sidebar
                sections.style.display = 'block';
                sidebar.classList.add('active');
                button.classList.add('active');
                layout.classList.add('filters-open');
            } else {
                // Closing: hide content immediately
                sections.style.display = 'none';
                sidebar.classList.remove('active');
                button.classList.remove('active');
                layout.classList.remove('filters-open');
            }
        }

        // Update filters and re-render portfolio
        function updateFilters() {
            // Collect all active filters from buttons
            activeFilters.themes = Array.from(document.querySelectorAll('#themeFilters .filter-btn.active')).map(btn => btn.getAttribute('data-filter-value'));
            activeFilters.styles = Array.from(document.querySelectorAll('#styleFilters .filter-btn.active')).map(btn => btn.getAttribute('data-filter-value'));
            activeFilters.watchModels = Array.from(document.querySelectorAll('#watchFilters .filter-btn.active')).map(btn => btn.getAttribute('data-filter-value'));

            // Update filter count badge
            const totalFilters = activeFilters.themes.length + activeFilters.styles.length +
                                activeFilters.watchModels.length;
            const filterCount = document.getElementById('filterCount');
            if (totalFilters > 0) {
                filterCount.style.display = 'inline-block';
                filterCount.textContent = totalFilters;
            } else {
                filterCount.style.display = 'none';
            }

            // Show/hide active filters display
            const activeFiltersDiv = document.getElementById('activeFilters');
            const activeFilterTags = document.getElementById('activeFilterTags');
            
            if (totalFilters > 0) {
                activeFiltersDiv.style.display = 'flex';
                activeFilterTags.innerHTML = '';
                
                // Add theme tags
                activeFilters.themes.forEach(themeId => {
                    const theme = portfolioMetaobjects.themes.find(t => t.id === themeId);
                    if (theme) {
                        activeFilterTags.innerHTML += createFilterTag(theme.name, 'theme', themeId);
                    }
                });
                
                // Add style tags
                activeFilters.styles.forEach(styleId => {
                    const style = portfolioMetaobjects.styles.find(s => s.id === styleId);
                    if (style) {
                        activeFilterTags.innerHTML += createFilterTag(style.name, 'style', styleId);
                    }
                });
                
                // Add watch model tags
                activeFilters.watchModels.forEach(model => {
                    activeFilterTags.innerHTML += createFilterTag(model, 'watchModel', model);
                });
            } else {
                activeFiltersDiv.style.display = 'none';
            }

            // Re-render portfolio with filters
            renderFilteredPortfolio();
        }

        // Create filter tag HTML
        function createFilterTag(label, type, value) {
            return `<span class="filter-tag">
                ${label}
                <span class="remove-tag" onclick="removeFilter('${type}', '${value}')">√ó</span>
            </span>`;
        }

        // Remove specific filter
        function removeFilter(type, value) {
            const button = document.querySelector(`#${type}Filters .filter-btn[data-filter-value="${value}"]`);
            if (button) {
                button.classList.remove('active');
                updateFilters();
            }
        }

        // Clear all filters
        function clearAllFilters() {
            document.querySelectorAll('.filter-btn.active').forEach(btn => btn.classList.remove('active'));
            activeFilters = {
                themes: [],
                styles: [],
                watchModels: []
            };
            updateFilters();
        }

        // Get readable type label
        function getTypeLabel(type) {
            const labels = {
                'custom_order': 'Commission',
                'bespoke_concept': 'Bespoke',
                'product': 'Ready to Buy',
                'collaboration': 'Collaboration'
            };
            return labels[type] || type;
        }

        // Render filtered portfolio
        function renderFilteredPortfolio() {
            const grid = document.getElementById('portfolioGrid');
            
            // Filter items based on active filters
            let filteredItems = portfolioMetaobjects.items.filter(item => {
                // Check theme filter
                if (activeFilters.themes.length > 0 && !activeFilters.themes.includes(item.theme_id)) {
                    return false;
                }
                
                // Check style filter
                if (activeFilters.styles.length > 0 && !activeFilters.styles.includes(item.style_id)) {
                    return false;
                }
                
                // Check watch model filter
                if (activeFilters.watchModels.length > 0 && item.watch_product && !activeFilters.watchModels.includes(item.watch_product.vendor)) {
                    return false;
                }
                
                return true;
            });

            // Render the filtered items
            if (filteredItems.length === 0) {
                grid.innerHTML = `
                    <div class="portfolio-empty" style="grid-column: 1/-1; text-align: center; padding: 60px 20px;">
                        <p style="color: #666; margin-bottom: 20px;">No items found matching your filters.</p>
                        <button class="btn-reset-filters" onclick="clearAllFilters()" style="padding: 10px 20px; background: #333; color: white; border: none; border-radius: 25px; cursor: pointer;">
                            Reset Filters
                        </button>
                    </div>
                `;
            } else {
                grid.innerHTML = filteredItems.map(item => createPortfolioCard(item)).join('');
            }
        }

        // Create portfolio card HTML
        function createPortfolioCard(item) {
            const badges = [];
            if (item.video_url) badges.push('<span class="badge badge-video">üé• Video</span>');
            if (item.instagram_url) badges.push('<span class="badge badge-instagram">üì∑ Instagram</span>');
            if (item.timelapse_url) badges.push('<span class="badge badge-timelapse">‚è± Timelapse</span>');
            
            const style = portfolioMetaobjects.styles.find(s => s.id === item.style_id);
            const theme = portfolioMetaobjects.themes.find(t => t.id === item.theme_id);
            
            return `
                <div class="portfolio-card" data-id="${item.id}">
                    <div class="portfolio-image-wrapper" onclick="window.location.href='portfolio-single.html?id=${item.handle}'">
                        <img src="${item.main_image}" alt="${item.title}" loading="lazy">
                        
                        ${badges.length > 0 ? `
                            <div class="portfolio-badges">
                                ${badges.join('')}
                            </div>
                        ` : ''}
                        
                        <div class="portfolio-overlay">
                            <button class="btn-quick-view" onclick="event.stopPropagation(); openQuickView('${item.id}')">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                                    <circle cx="12" cy="12" r="3"/>
                                </svg>
                                <span>Quick View</span>
                            </button>
                        </div>
                    </div>
                    
                    <div class="portfolio-info">
                        <h4>${item.title}</h4>
                        <div class="portfolio-meta">
                            <div class="portfolio-tags">
                                <span class="portfolio-tag">${style ? style.name : ''}</span>
                                <span class="portfolio-tag">${theme ? theme.name : ''}</span>
                            </div>
                            <span class="portfolio-type">${getTypeLabel(item.portfolio_type)}</span>
                        </div>
                    </div>
                </div>
            `;
        }

        // Quick view modal (placeholder)
        function openQuickView(itemId) {
            alert('Quick View for item: ' + itemId + ' (to be implemented)');
        }

        // Populate filters on page load
        window.addEventListener('load', () => {
            // Theme filters
            const themeContainer = document.getElementById('themeFilters');
            if (themeContainer && portfolioMetaobjects) {
                portfolioMetaobjects.themes.forEach(theme => {
                    const button = document.createElement('button');
                    button.className = 'filter-btn';
                    button.setAttribute('data-filter-type', 'theme');
                    button.setAttribute('data-filter-value', theme.id);
                    button.textContent = theme.name;
                    button.onclick = function() {
                        this.classList.toggle('active');
                        updateFilters();
                    };
                    themeContainer.appendChild(button);
                });
            }

            // Style filters  
            const styleContainer = document.getElementById('styleFilters');
            if (styleContainer && portfolioMetaobjects) {
                portfolioMetaobjects.styles.forEach(style => {
                    const button = document.createElement('button');
                    button.className = 'filter-btn';
                    button.setAttribute('data-filter-type', 'style');
                    button.setAttribute('data-filter-value', style.id);
                    button.textContent = style.name;
                    button.onclick = function() {
                        this.classList.toggle('active');
                        updateFilters();
                    };
                    styleContainer.appendChild(button);
                });
            }

            // Watch Model filters
            const watchContainer = document.getElementById('watchFilters');
            if (watchContainer && portfolioMetaobjects) {
                const watchModels = [...new Set(portfolioMetaobjects.items
                    .map(item => item.watch_product?.vendor)
                    .filter(Boolean))];
                
                watchModels.forEach(model => {
                    const button = document.createElement('button');
                    button.className = 'filter-btn';
                    button.setAttribute('data-filter-type', 'watchModel');
                    button.setAttribute('data-filter-value', model);
                    button.textContent = model;
                    button.onclick = function() {
                        this.classList.toggle('active');
                        updateFilters();
                    };
                    watchContainer.appendChild(button);
                });
            }

            // Initial render
            renderFilteredPortfolio();
        });
    </script>
</body>
</html>
