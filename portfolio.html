<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>Portfolio - IFL Watches</title>
    
    <!-- Shared styles (DRY!) -->
    <link rel="stylesheet" href="shared/styles.css">
    <link rel="stylesheet" href="shared/navigation.css">
    <link rel="stylesheet" href="shared/portfolio-styles-v2.css">
    
    <!-- Navigation script -->
    <script src="shared/navigation.js"></script>
    
    <!-- Portfolio data -->
    <script src="shared/portfolio-data-v2.js"></script>
</head>
<body>
    <!-- Navigation –±—É–¥–µ—Ç –≤—Å—Ç–∞–≤–ª–µ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ navigation.js -->

    <!-- Portfolio Content -->
    <main class="portfolio-container">
        <!-- Header -->
        <div class="portfolio-header">
            <h1>PORTFOLIO</h1>
            <p>Explore our collection of hand-painted masterpieces, each telling a unique story</p>
        </div>
        
        <!-- Filters -->
        <div class="portfolio-filters">
            <div class="filter-group">
                <label for="styleFilter">Style:</label>
                <select id="styleFilter">
                    <option value="">All Styles</option>
                </select>
            </div>
            
            <div class="filter-group">
                <label for="themeFilter">Theme:</label>
                <select id="themeFilter">
                    <option value="">All Themes</option>
                </select>
            </div>
            
            <div class="filter-group">
                <label for="typeFilter">Type:</label>
                <select id="typeFilter">
                    <option value="">All Types</option>
                    <option value="custom_order">Bespoke Order</option>
                    <option value="product">Ready Design</option>
                    <option value="concept">Concept Art</option>
                </select>
            </div>
        </div>
        
        <!-- Portfolio Grid -->
        <div class="portfolio-grid" id="portfolioGrid">
            <div class="portfolio-loading">Loading portfolio...</div>
        </div>
    </main>

    <script>
        // Portfolio renderer
        class PortfolioGrid {
            constructor() {
                this.grid = document.getElementById('portfolioGrid');
                this.filters = {
                    style: '',
                    theme: '',
                    type: ''
                };
                this.init();
            }
            
            init() {
                this.populateFilters();
                this.attachEventListeners();
                this.render();
            }
            
            populateFilters() {
                // Populate style filter
                const styleSelect = document.getElementById('styleFilter');
                portfolioMetaobjects.styles.forEach(style => {
                    const option = document.createElement('option');
                    option.value = style.id;
                    option.textContent = style.name;
                    styleSelect.appendChild(option);
                });
                
                // Populate theme filter
                const themeSelect = document.getElementById('themeFilter');
                portfolioMetaobjects.themes.forEach(theme => {
                    const option = document.createElement('option');
                    option.value = theme.id;
                    option.textContent = theme.name;
                    themeSelect.appendChild(option);
                });
            }
            
            attachEventListeners() {
                document.getElementById('styleFilter').addEventListener('change', (e) => {
                    this.filters.style = e.target.value;
                    this.render();
                });
                
                document.getElementById('themeFilter').addEventListener('change', (e) => {
                    this.filters.theme = e.target.value;
                    this.render();
                });
                
                document.getElementById('typeFilter').addEventListener('change', (e) => {
                    this.filters.type = e.target.value;
                    this.render();
                });
            }
            
            render() {
                const items = portfolioHelpers.filterItems(this.filters);
                
                if (items.length === 0) {
                    this.grid.innerHTML = `
                        <div class="portfolio-empty">
                            <p>No items found matching your filters.</p>
                            <button class="btn-reset-filters" onclick="portfolioGrid.resetFilters()">
                                Reset Filters
                            </button>
                        </div>
                    `;
                    return;
                }
                
                this.grid.innerHTML = items.map(item => this.createCard(item)).join('');
                
                // Add click handlers for mobile
                this.addMobileHandlers();
            }
            
            createCard(item) {
                const badges = [];
                if (item.video_url) badges.push('<span class="badge badge-video">üé•</span>');
                if (item.instagram_url) badges.push('<span class="badge badge-instagram">üì∑</span>');
                if (item.timelapse_url) badges.push('<span class="badge badge-timelapse">‚è±</span>');
                
                // –ö—Ä–∞—Å–∏–≤—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è –¥–ª—è —Ç–∏–ø–æ–≤
                const typeLabels = {
                    'custom_order': 'Bespoke',
                    'product': 'Ready',
                    'concept': 'Concept'
                };
                
                return `
                    <div class="portfolio-card" data-id="${item.id}">
                        <div class="portfolio-image-wrapper">
                            <img src="${item.main_image}" alt="${item.title}" loading="lazy">
                            
                            ${item.featured ? '<div class="featured-badge">Featured</div>' : ''}
                            
                            ${badges.length > 0 ? `
                                <div class="portfolio-badges">
                                    ${badges.join('')}
                                </div>
                            ` : ''}
                            
                            <div class="portfolio-overlay">
                                <div class="portfolio-quick-info">
                                    <h3>${item.title}</h3>
                                    <p class="overlay-meta">${item.style.name} ‚Ä¢ ${item.theme.name}</p>
                                    ${item.watch_product ? `
                                        <p class="watch-model">
                                            ${item.watch_product.vendor} ${item.watch_product.title}
                                        </p>
                                    ` : ''}
                                </div>
                                <a href="#" class="btn-view-details" onclick="portfolioGrid.viewDetails('${item.id}'); return false;">
                                    View Details
                                </a>
                            </div>
                        </div>
                        
                        <div class="portfolio-info">
                            <h4>${item.title}</h4>
                            <div class="portfolio-meta">
                                <div class="portfolio-tags">
                                    <span class="tag tag-style">${item.style.name}</span>
                                    <span class="tag tag-theme">${item.theme.name}</span>
                                </div>
                                <span class="portfolio-type">${typeLabels[item.portfolio_type]}</span>
                            </div>
                            ${item.watch_product ? 
                                `<p class="portfolio-watch">${item.watch_product.vendor} ${item.watch_product.title}</p>` 
                                : ''}
                        </div>
                    </div>
                `;
            }
            
            addMobileHandlers() {
                // –ù–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö –¥–µ–ª–∞–µ–º overlay –≤–∏–¥–∏–º—ã–º –ø–æ –∫–ª–∏–∫—É
                if (window.innerWidth <= 768) {
                    document.querySelectorAll('.portfolio-card').forEach(card => {
                        card.addEventListener('click', function(e) {
                            if (!e.target.closest('.btn-view-details')) {
                                // Toggle active class
                                document.querySelectorAll('.portfolio-card').forEach(c => {
                                    if (c !== this) c.classList.remove('active');
                                });
                                this.classList.toggle('active');
                            }
                        });
                    });
                }
            }
            
            viewDetails(itemId) {
                const item = portfolioHelpers.getActiveItems().find(p => p.id === itemId);
                if (item) {
                    // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ —ç—Ç–æ –±—ã –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–ª–æ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–µ—Ç–∞–ª–∏
                    console.log('View details for:', item);
                    alert(`Opening: ${item.title}\n\nThis would navigate to:\n/portfolio/${item.handle}`);
                }
            }
            
            resetFilters() {
                this.filters = { style: '', theme: '', type: '' };
                document.getElementById('styleFilter').value = '';
                document.getElementById('themeFilter').value = '';
                document.getElementById('typeFilter').value = '';
                this.render();
            }
        }
        
        // Initialize portfolio grid
        const portfolioGrid = new PortfolioGrid();
    </script>
</body>
</html>